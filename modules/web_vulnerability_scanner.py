# web_vulnerability_scanner.py
import requests
from bs4 import BeautifulSoup
from utils.logger import log
import json
import yaml

def run():
    url = input("Enter URL to scan: ")
    response = requests.get(url)
    soup = BeautifulSoup(response.text, 'html.parser')
    forms = soup.find_all('form')
    
    with open('data/payloads/xss_payloads.json') as f:
        xss_payloads = json.load(f)
    
    with open('data/payloads/sql_payloads.yaml') as f:
        sql_payloads = yaml.safe_load(f)

    for form in forms:
        action = form.get('action')
        method = form.get('method', 'get').lower()
        inputs = form.find_all('input')
        for payload in xss_payloads + sql_payloads:
            data = {i.get('name'): payload for i in inputs if i.get('name')}
            target = url + action if action.startswith('/') else action
            if method == 'post':
                r = requests.post(target, data=data)
            else:
                r = requests.get(target, params=data)
            if payload in r.text:
                log(f"[!] Vulnerability detected with payload: {payload}")
